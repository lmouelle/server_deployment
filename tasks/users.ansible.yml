---

- name: "Create user {{ username }}"
  become: true
  become_user: root
  ansible.builtin.user:
    name: "{{ username }}"
    state: present
    umask: '077'

- name: Arrange quadlets, config, state and secrets
  ansible.builtin.include_tasks: "{{ username }}.ansible.yml"

- name: Set user to linger on login
  become: true
  become_user: root
  changed_when: true
  ansible.builtin.command:
    cmd: "loginctl enable-linger {{ username }} --no-ask-password --no-pager"

# TODO: Ensure user started now and check that login is a success, container is up and stays up, etc
# If the container/user started earlier and stuff like file perms/selinux weren't yet set, we'll have issues
